name: deepwork_jobs
version: "1.4.0"
summary: "DeepWork job management commands"
description: |
  # DeepWork Jobs Overview

  DeepWork jobs are multi-step AI workflows that break complex tasks into manageable,
  repeatable steps. Each job is defined in a `job.yml` file and consists of:

  - **Steps**: Individual tasks with clear inputs, outputs, and instructions
  - **Dependencies**: Ordering constraints between steps
  - **Hooks**: Quality validation loops that ensure outputs meet standards
  - **Skills**: Reusable AI capabilities that jobs can install

  ## How Jobs Work

  Jobs follow a **define → implement → use** workflow:

  1. **Define** (`/deepwork_jobs.define`): Interactive Q&A to understand your workflow
     and create a `job.yml` specification. This captures what each step does, what
     inputs it needs, and what outputs it produces.

  2. **Implement** (`/deepwork_jobs.implement`): Generates detailed instruction files
     for each step based on the spec. Creates the directory structure and syncs
     commands to make them available as slash commands.

  3. **Use**: Each step becomes a slash command like `/job_name.step_id`. Run steps
     in order (respecting dependencies) to complete the workflow.

  ## Refining Jobs

  The `refine` command (`/deepwork_jobs.refine`) helps modify existing jobs safely
  by understanding what you want to change, validating the impact, and ensuring
  consistency across your workflow.

  ## Job Structure

  Jobs live in `.deepwork/jobs/[job_name]/` with:
  - `job.yml` - The job specification
  - `steps/` - Instruction files for each step
  - `hooks/` - Optional hook scripts and prompts

  ## Creating Jobs Casually

  You can ask Claude to create jobs naturally, like "Make a new job that does X"
  or "I need a workflow for Y". Claude will invoke the appropriate commands
  automatically.

changelog:
  - version: "1.0.0"
    changes: "Initial job creation"
  - version: "1.1.0"
    changes: "Added stop hooks for quality validation loops on all steps"
  - version: "1.2.0"
    changes: "Updated to support array of stop hooks"
  - version: "1.3.0"
    changes: "Added policy awareness to implement step - suggests relevant policies after job implementation"
  - version: "1.4.0"
    changes: "Added skills section with workflow guide for casual job creation; enhanced description with comprehensive workflow documentation"

skills:
  - name: deepwork-jobs
    description: |
      Use this skill when the user wants to create, modify, or understand DeepWork jobs.
      Triggers on phrases like "make a job", "create a workflow", "new job for", "define a job",
      or questions about how DeepWork jobs work.
    user_invocable: false
    content: |
      # DeepWork Jobs Workflow Guide

      When users want to create or modify DeepWork jobs, guide them through the appropriate workflow.

      ## Creating a New Job

      To create a new job, follow this sequence:

      1. **First, run `/deepwork_jobs.define`** - This will:
         - Ask the user about their workflow goals
         - Understand the steps, inputs, and outputs
         - Create the `job.yml` specification file
         - The define step uses interactive Q&A, so let it guide the conversation

      2. **Then, run `/deepwork_jobs.implement`** - This will:
         - Read the job.yml created by define
         - Generate instruction files for each step
         - Run `deepwork sync` to create slash commands
         - Create an implementation summary

      3. **Tell the user to reload commands** - After implementation, they need to:
         - Run `/reload` or restart their session to see new commands

      ## Modifying an Existing Job

      To modify an existing job:

      1. **Run `/deepwork_jobs.refine`** with the job name
         - This handles changes safely and maintains consistency
         - Updates version numbers and changelog
         - Re-syncs commands after changes

      ## Understanding the Workflow

      When users ask questions about jobs, explain:

      - Jobs are multi-step workflows defined in `.deepwork/jobs/[name]/job.yml`
      - Each step has inputs (user parameters or files from previous steps) and outputs
      - Steps can have dependencies on other steps
      - Quality hooks (stop_hooks) enable AI self-validation before completing steps
      - Skills can be bundled with jobs to provide additional capabilities

      ## Example Interaction

      User: "I want to create a job for writing blog posts"

      Response: "I'll help you create a blog post workflow! Let me start the job definition process."
      Then invoke: `/deepwork_jobs.define`

      User: "How do jobs work?"

      Response: Explain the define → implement → use workflow from the job description.

      ## Important Notes

      - Always use the slash commands (`/deepwork_jobs.define`, etc.) rather than trying
        to create job files manually - the commands handle validation and structure
      - The define step is interactive - it will ask questions; don't try to create
        the job.yml directly without going through the Q&A process
      - After implementing a job, always remind users to reload commands

steps:
  - id: define
    name: "Define Job Specification"
    description: "Create the job.yml specification file by understanding workflow requirements"
    instructions_file: steps/define.md
    inputs:
      - name: job_purpose
        description: "What complex task or workflow are you trying to accomplish?"
    outputs:
      - job.yml
    dependencies: []
    stop_hooks:
      - prompt: |
          Verify the job.yml output meets ALL quality criteria before completing:

          1. **User Understanding**: Did you fully understand the user's workflow through interactive Q&A?
          2. **Clear Inputs/Outputs**: Does every step have clearly defined inputs and outputs?
          3. **Logical Dependencies**: Do step dependencies make sense and avoid circular references?
          4. **Concise Summary**: Is the summary under 200 characters and descriptive?
          5. **Rich Description**: Does the description explain:
             - What the workflow accomplishes
             - How the steps connect (the workflow flow)
             - Any background context or prerequisites users need
             - How to use the job effectively
          6. **Skills Quality** (if skills are included):
             - Does each skill have a clear description explaining when Claude should use it?
             - Does the skill content provide comprehensive workflow guidance?
             - Does the content explain each step and when to use it?
             - Are there domain-specific tips or context included?
          7. **Valid Schema**: Does the job.yml follow the required schema (name, version, summary, steps)?
          8. **File Created**: Has the job.yml file been created in `.deepwork/jobs/[job_name]/job.yml`?

          If ANY criterion is not met, continue working to address it.
          If ALL criteria are satisfied, include `<promise>QUALITY_COMPLETE</promise>` in your response.

  - id: implement
    name: "Implement Job Steps"
    description: "Generate instruction files for each step based on the job.yml specification"
    instructions_file: steps/implement.md
    inputs:
      - file: job.yml
        from_step: define
    outputs:
      - implementation_summary.md
    dependencies:
      - define
    stop_hooks:
      - prompt: |
          Verify the implementation meets ALL quality criteria before completing:

          1. **Directory Structure**: Is `.deepwork/jobs/[job_name]/` created correctly?
          2. **Complete Instructions**: Are ALL step instruction files complete (not stubs or placeholders)?
          3. **Specific & Actionable**: Are instructions tailored to each step's purpose, not generic?
          4. **Output Examples**: Does each instruction file show what good output looks like?
          5. **Quality Criteria**: Does each instruction file define quality criteria for its outputs?
          6. **Sync Complete**: Has `deepwork sync` been run successfully?
          7. **Commands Available**: Are the slash-commands generated in `.claude/commands/`?
          8. **Summary Created**: Has `implementation_summary.md` been created?
          9. **Policies Considered**: Have you thought about whether policies would benefit this job?
             - If relevant policies were identified, did you explain them and offer to run `/deepwork_policy.define`?
             - Not every job needs policies - only suggest when genuinely helpful.

          If ANY criterion is not met, continue working to address it.
          If ALL criteria are satisfied, include `<promise>QUALITY_COMPLETE</promise>` in your response.

  - id: refine
    name: "Refine Existing Job"
    description: "Modify an existing job definition"
    instructions_file: steps/refine.md
    inputs:
      - name: job_name
        description: "Name of the job to refine"
    outputs:
      - job.yml
    dependencies: []
    stop_hooks:
      - prompt: |
          Verify the refinement meets ALL quality criteria before completing:

          1. **Job Consistency**: Do the changes maintain overall job consistency?
          2. **Valid Dependencies**: Are all step dependencies logically valid (no circular refs)?
          3. **Semantic Versioning**: Was the version bumped appropriately (major/minor/patch)?
          4. **Changelog Updated**: Is the changelog updated with a description of changes?
          5. **User Understanding**: Does the user understand the impact of the changes?
          6. **Breaking Changes**: Were any breaking changes clearly communicated?
          7. **Files Updated**: Are all affected files (job.yml, step files) updated?
          8. **Sync Complete**: Has `deepwork sync` been run to regenerate commands?

          If ANY criterion is not met, continue working to address it.
          If ALL criteria are satisfied, include `<promise>QUALITY_COMPLETE</promise>` in your response.
