---
name: make_release.prepare_release
description: "Update changelog, bump version in pyproject.toml, and sync uv.lock"
user-invocable: false
---

# make_release.prepare_release

**Step 2/3** in **make_release** workflow

> Automate release preparation with changelog, version bump, and PR creation

## Prerequisites (Verify First)

Before proceeding, confirm these steps are complete:
- `/make_release.gather_changes`

## Instructions

**Goal**: Update changelog, bump version in pyproject.toml, and sync uv.lock

# Prepare Release Files

## Objective

Update the CHANGELOG.md with a new version entry, bump the version in pyproject.toml, and sync uv.lock.

## Task

Read the changes summary from the previous step and use it to update the release files with the confirmed version number.

### Process

1. **Read the changes summary**
   Load `release/changes_summary.md` to get:
   - The confirmed new version number
   - The categorized changes

2. **Update CHANGELOG.md**
   Add a new version entry at the top of the changelog (after the header), following the Keep a Changelog format:

   ```markdown
   ## [X.Y.Z] - YYYY-MM-DD

   ### Added
   - [features from changes summary]

   ### Changed
   - [modifications from changes summary]

   ### Fixed
   - [bug fixes from changes summary]
   ```

   Also add the version link at the bottom:
   ```markdown
   [X.Y.Z]: https://github.com/anthropics/deepwork/releases/tag/X.Y.Z
   ```

3. **Update pyproject.toml**
   Change the `version` field to the new version:
   ```toml
   version = "X.Y.Z"
   ```

4. **Sync uv.lock**
   Run:
   ```bash
   uv lock
   ```
   This updates the lock file with the new version.

## Output Format

The outputs are modifications to existing files:

### CHANGELOG.md

Add a new version section following Keep a Changelog format. Only include categories that have entries (don't include empty "### Removed" sections).

**Example entry**:
```markdown
## [0.6.0] - 2026-01-21

### Added
- New `make_release` job for automating release preparation

### Fixed
- Fixed edge case in version parsing
```

### pyproject.toml

Update the version field:
```toml
version = "0.6.0"
```

### uv.lock

This is auto-generated by `uv lock`. No manual edits needed.

## Quality Criteria

- CHANGELOG.md has a new version entry with today's date
- Version entry follows Keep a Changelog format
- Only non-empty categories are included in the changelog entry
- pyproject.toml version is updated to match
- `uv lock` ran successfully
- Version link is added at the bottom of CHANGELOG.md
- Changes in CHANGELOG match what was in the changes summary
- When all criteria are met, include `<promise>âœ“ Quality Criteria Met</promise>` in your response

## Context

This step transforms the raw change data into properly formatted release files. The CHANGELOG.md follows the Keep a Changelog format used by this project, which organizes changes into categories like Added, Changed, Fixed, etc. The next step will create a PR with these changes.


### Job Context

A streamlined workflow for preparing releases of the DeepWork project. This job
automates the tedious parts of releasing: finding the latest version tag, gathering
commits since that tag, updating the changelog, bumping the version in pyproject.toml,
syncing uv.lock, and creating a pull request.

The workflow analyzes commit history to recommend an appropriate version bump
(patch, minor, or major) based on the changes, then asks for confirmation before
proceeding.

Outputs:
- Updated CHANGELOG.md with a new version entry
- Updated pyproject.toml with the new version
- Updated uv.lock
- A pull request targeting main


## Required Inputs


**Files from Previous Steps** - Read these first:
- `release/changes_summary.md` (from `gather_changes`)

## Work Branch

Use branch format: `deepwork/make_release-[instance]-YYYYMMDD`

- If on a matching work branch: continue using it
- If on main/master: create new branch with `git checkout -b deepwork/make_release-[instance]-$(date +%Y%m%d)`

## Outputs

**Required outputs**:
- `CHANGELOG.md`
- `pyproject.toml`
- `uv.lock`

## Guardrails

- Do NOT skip prerequisite verification if this step has dependencies
- Do NOT produce partial outputs; complete all required outputs before finishing
- Do NOT proceed without required inputs; ask the user if any are missing
- Do NOT modify files outside the scope of this step's defined outputs

## On Completion

1. Verify outputs are created
2. Inform user: "Step 2/3 complete, outputs: CHANGELOG.md, pyproject.toml, uv.lock"
3. **Continue workflow**: Use Skill tool to invoke `/make_release.create_pr`

---

**Reference files**: `.deepwork/jobs/make_release/job.yml`, `.deepwork/jobs/make_release/steps/prepare_release.md`