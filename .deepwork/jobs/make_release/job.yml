name: make_release
version: "1.0.0"
summary: "Automate release preparation with changelog, version bump, and PR creation"
description: |
  A streamlined workflow for preparing releases of the DeepWork project. This job
  automates the tedious parts of releasing: finding the latest version tag, gathering
  commits since that tag, updating the changelog, bumping the version in pyproject.toml,
  syncing uv.lock, and creating a pull request.

  The workflow analyzes commit history to recommend an appropriate version bump
  (patch, minor, or major) based on the changes, then asks for confirmation before
  proceeding.

  Outputs:
  - Updated CHANGELOG.md with a new version entry
  - Updated pyproject.toml with the new version
  - Updated uv.lock
  - A pull request targeting main

changelog:
  - version: "1.0.0"
    changes: "Initial job creation"

steps:
  - id: gather_changes
    name: "Gather Changes Since Last Release"
    description: "Find the latest version tag and collect all commits since then"
    instructions_file: steps/gather_changes.md
    inputs: []
    outputs:
      - release/changes_summary.md
    dependencies: []

  - id: prepare_release
    name: "Prepare Release Files"
    description: "Update changelog, bump version in pyproject.toml, and sync uv.lock"
    instructions_file: steps/prepare_release.md
    inputs:
      - file: release/changes_summary.md
        from_step: gather_changes
    outputs:
      - CHANGELOG.md
      - pyproject.toml
      - uv.lock
    dependencies:
      - gather_changes

  - id: create_pr
    name: "Create Release PR"
    description: "Create a pull request with the release changes targeting main"
    instructions_file: steps/create_pr.md
    inputs: []
    outputs:
      - release/pr_url.md
    dependencies:
      - prepare_release
