name: add_platform
version: "0.1.0"
summary: "Add a new AI platform to DeepWork with adapter, templates, and tests"

description: |
  A workflow for adding support for a new AI platform (like Cursor, Windsurf, etc.) to DeepWork.

  This job guides you through four phases:
  1. **Research**: Capture the platform's CLI configuration and hooks system documentation
  2. **Add Capabilities**: Update the job schema and adapters with any new hook events
  3. **Implement**: Create the platform adapter, templates, tests (100% coverage), and README updates
  4. **Verify**: Ensure installation works correctly and produces expected files

  The workflow ensures consistency across all supported platforms and maintains
  comprehensive test coverage for new functionality.

  **Important Notes**:
  - Only hooks available on slash command definitions should be captured
  - Each existing adapter must be updated when new hooks are added (typically with null values)
  - Tests must achieve 100% coverage for any new functionality
  - Installation verification confirms the platform integrates correctly with existing jobs

changelog:
  - version: "0.1.0"
    changes: "Initial version"

steps:
  - id: research
    name: "Research Platform Documentation"
    description: "Capture CLI configuration and hooks system documentation for the new platform"
    instructions_file: steps/research.md
    inputs:
      - name: platform_name
        description: "Clear identifier of the platform (e.g., 'cursor', 'windsurf-editor', 'github-copilot-chat')"
    outputs:
      - cli_configuration.md
      - hooks_system.md
    dependencies: []
    quality_criteria:
      - "Do both files exist in doc/platforms/<platform>/: cli_configuration.md and hooks_system.md?"
      - "Does each file have a comment at the top with last updated date and source URL?"
      - "Does cli_configuration.md cover how the platform's CLI is configured?"
      - "Does hooks_system.md cover hooks available for slash command definitions ONLY?"
      - "Is there no extraneous documentation (only these two specific topics)?"
      - "Is the documentation comprehensive enough to implement the platform?"

  - id: add_capabilities
    name: "Add Hook Capabilities"
    description: "Update job schema and adapters with any new hook events the platform supports"
    instructions_file: steps/add_capabilities.md
    inputs:
      - file: hooks_system.md
        from_step: research
    outputs:
      - job_schema.py
      - adapters.py
    dependencies:
      - research
    quality_criteria:
      - "Are any new hooks from the platform (for slash commands only) added to src/deepwork/schemas/job_schema.py?"
      - "Are all existing adapters in src/deepwork/adapters.py updated with the new hook fields? (set to None/null if the platform doesn't support that hook)"
      - "Are only hooks available on slash command definitions added (not general CLI hooks)?"
      - "Does job_schema.py remain valid Python with no syntax errors?"
      - "Is adapters.py consistent - all adapters have the same hook fields?"
      - "If no new hooks are needed, is there documentation explaining why?"

  - id: implement
    name: "Implement Platform Support"
    description: "Add platform adapter, templates, tests with 100% coverage, and README documentation"
    instructions_file: steps/implement.md
    inputs:
      - file: job_schema.py
        from_step: add_capabilities
      - file: adapters.py
        from_step: add_capabilities
      - file: cli_configuration.md
        from_step: research
    outputs:
      - templates/
      - tests/
      - README.md
    dependencies:
      - research
      - add_capabilities
    hooks:
      after_agent:
        - script: hooks/run_tests.sh
    quality_criteria:
      - "Is the platform adapter class added to src/deepwork/adapters.py?"
      - "Do templates exist in src/deepwork/templates/<platform>/ with appropriate command structure?"
      - "Do tests exist for all new functionality?"
      - "Is test coverage 100% for new code (run: uv run pytest --cov)?"
      - "Do all tests pass?"
      - "Is README.md updated with: New platform listed in supported platforms, Installation instructions for the platform, Any platform-specific notes"

  - id: verify
    name: "Verify Installation"
    description: "Set up platform directories and verify deepwork install works correctly"
    instructions_file: steps/verify.md
    inputs:
      - file: templates/
        from_step: implement
    outputs: []
    dependencies:
      - implement
    quality_criteria:
      - "Are platform-specific directories/files added to the deepwork repo as needed?"
      - "Does running `deepwork install --platform <platform>` complete without errors?"
      - "Are expected command files created in the platform's command directory?"
      - "Does command file content match the templates and job definitions?"
      - "Are established DeepWork jobs (deepwork_jobs, deepwork_rules) installed correctly?"
      - "Can the platform be used alongside existing platforms without conflicts?"
