# review_pr
#
# Coordinates expert-driven PR review with iterative improvement cycles until all feedback is addressed.
#
# Generated by DeepWork - do not edit manually

description = "Coordinates expert-driven PR review with iterative improvement cycles until all feedback is addressed."

prompt = """
# review_pr

**Multi-step workflow**: Coordinates expert-driven PR review with iterative improvement cycles until all feedback is addressed.

> **NOTE**: Gemini CLI requires manual command invocation. After each step, tell the user which command to run next.

A multi-phase workflow for comprehensive pull request review using domain experts.

The workflow operates in three phases:
1. **Relevance Check**: All available experts examine the PR changes in parallel to determine
   if any changes fall within their domain of expertise.
2. **Deep Review**: Experts who found relevant changes perform detailed code review, producing
   written feedback and specific code change suggestions.
3. **Improvement Cycle**: The PR is improved based on feedback, then re-reviewed by the same
   experts. This cycle repeats until all experts report no further feedback or 3 iterations
   are reached.

Produces:
- Relevance assessments from all experts
- Detailed review feedback with code suggestions
- Iteratively improved PR code

Requires: PR branch checked out, `gh` CLI available for PR metadata


## Available Steps

1. **check_relevance** - Invokes all available experts in parallel to assess if PR changes are relevant to their domain. Use at the start of a PR review.
   Command: `/review_pr:check_relevance`
2. **deep_review** - Invokes only relevant experts (from previous step) to perform detailed code review. Use after relevance check identifies applicable experts. (requires: check_relevance)
   Command: `/review_pr:deep_review`
3. **improve_and_rereview** - Applies expert feedback to improve the PR, then re-runs expert reviews. Cycles until no further feedback or 3 iterations. Use after deep review completes. (requires: deep_review)
   Command: `/review_pr:improve_and_rereview`

## Execution Instructions

### Step 1: Analyze Intent

Parse any text following `/review_pr` to determine user intent:
- "check_relevance" or related terms → start at `/review_pr:check_relevance`
- "deep_review" or related terms → start at `/review_pr:deep_review`
- "improve_and_rereview" or related terms → start at `/review_pr:improve_and_rereview`

### Step 2: Direct User to Starting Step

Tell the user which command to run:
```
/review_pr:check_relevance
```

### Step 3: Guide Through Workflow

After each step completes, tell the user the next command to run until workflow is complete.

### Handling Ambiguous Intent

If user intent is unclear:
- Present available steps as numbered options
- Ask user to select the starting point

## Reference

- Job definition: `.deepwork/jobs/review_pr/job.yml`
"""